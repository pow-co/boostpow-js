"use strict"
var expect = require("chai").expect
var index = require("../")

var bsv = require("../dist/bsv")
var sampleTx1 =
  "010000000174d9f6dc235207fbbcdff7bdc412dcb375eb634da698ed164cc1e9aa1b88729a" +
  "040000006b4830450221008596410738406e0e8589292a0e7a4d960e739025ab1859a3df6c" +
  "77b4cf8c59ac0220733024f199162bc7b9ccd648aae56f0a0e307558a9827a26d35b1016de" +
  "1865c54121025a77fe27d1db166b660205ff08b97f7dd87c7c68edaa2931895c2c8577f1a3" +
  "51ffffffff027d20000000000000e108626f6f7374706f777504000000002035b8fcb6882f" +
  "93bddb928c9872198bcdf057ab93ed615ad938f24a63abde588104ffff001d140000000000" +
  "00000000000000000000000000000004000000002000000000000000000000000000000000" +
  "000000000000000000000000000000007e7c557a766b7e52796b557a8254887e557a8258887e7c7eaa7c6b7e7e7c8254887e6c7e7c8254887eaa01007e816c825488537f7681530121a5696b768100a0691d00000000000000000000000000000000000000000000000000000000007e6c539458959901007e819f6976a96c88acb461590e000000001976a914ba6e459a2b505dc78e44e8c5874776c00890e16088ac00000000";
var sampleTx1Value = 8317
var sampleTx1Vout = 0
var sampleTx1id =
  "4eb545a588a21045495e74449b348ce1eb8f48ac95356c519a2a85a57731a518"



describe("boost #fromTransactions decode known tx", () => {
  it("succeeds", async () => {
    const tx=new bsv.Transaction(
        "010000000107f3664fd5da563fd5716fe641bc6924c171c3558b35151aaf45156054c43c27000000006a47304402201ab947a7010271fcf5e4602c8e7cd448315579fb8f36ef61376b4f6d411ea0c3022030a436fa51e8a57a0443c6c6c4888e3b972b7be5706d8173a11bc90a297eb874412103727f42181e2293b47910789105ab63ded087b52bbc7a8a98c89cac4e91ee002fffffffff020807000000000000e108626f6f7374706f7775040000000020000000000000000000000000000000000000000000000000000000000000000004a0aa0a1c14000000000000000000000000000000000000000004000000002007f3664fd5da563fd5716fe641bc6924c171c3558b35151aaf45156054c43c277e7c557a766b7e52796b557a8254887e557a8258887e7c7eaa7c6b7e7e7c8254887e6c7e7c8254887eaa01007e816c825488537f7681530121a5696b768100a0691d00000000000000000000000000000000000000000000000000000000007e6c539458959901007e819f6976a96c88ac0807000000000000e108626f6f7374706f7775040000000020000000000000000000000000000000000000000000000000000000000000000004a0aa0a1c14000000000000000000000000000000000000000004000000002007f3664fd5da563fd5716fe641bc6924c171c3558b35151aaf45156054c43c277e7c557a766b7e52796b557a8254887e557a8258887e7c7eaa7c6b7e7e7c8254887e6c7e7c8254887eaa01007e816c825488537f7681530121a5696b768100a0691d00000000000000000000000000000000000000000000000000000000007e6c539458959901007e819f6976a96c88ac00000000"
      );
    const jobs = index.transaction.fromTransaction(tx);
    expect(jobs.jobs[0].toASM()).to.eql(
      "626f6f7374706f77 OP_DROP 00000000 0000000000000000000000000000000000000000000000000000000000000000 a0aa0a1c 0000000000000000000000000000000000000000 00000000 07f3664fd5da563fd5716fe641bc6924c171c3558b35151aaf45156054c43c27 OP_CAT OP_SWAP OP_5 OP_ROLL OP_DUP OP_TOALTSTACK OP_CAT OP_2 OP_PICK OP_TOALTSTACK OP_5 OP_ROLL OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_5 OP_ROLL OP_SIZE OP_8 OP_EQUALVERIFY OP_CAT OP_SWAP OP_CAT OP_HASH256 OP_SWAP OP_TOALTSTACK OP_CAT OP_CAT OP_SWAP OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_FROMALTSTACK OP_CAT OP_SWAP OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_HASH256 00 OP_CAT OP_BIN2NUM OP_FROMALTSTACK OP_SIZE OP_4 OP_EQUALVERIFY OP_3 OP_SPLIT OP_DUP OP_BIN2NUM OP_3 21 OP_WITHIN OP_VERIFY OP_TOALTSTACK OP_DUP OP_BIN2NUM 0 OP_GREATERTHAN OP_VERIFY 0000000000000000000000000000000000000000000000000000000000 OP_CAT OP_FROMALTSTACK OP_3 OP_SUB OP_8 OP_MUL OP_RSHIFT 00 OP_CAT OP_BIN2NUM OP_LESSTHAN OP_VERIFY OP_DUP OP_HASH160 OP_FROMALTSTACK OP_EQUALVERIFY OP_CHECKSIG"
    )

    expect(jobs.jobs[1].toASM()).to.eql(
      "626f6f7374706f77 OP_DROP 00000000 0000000000000000000000000000000000000000000000000000000000000000 a0aa0a1c 0000000000000000000000000000000000000000 00000000 07f3664fd5da563fd5716fe641bc6924c171c3558b35151aaf45156054c43c27 OP_CAT OP_SWAP OP_5 OP_ROLL OP_DUP OP_TOALTSTACK OP_CAT OP_2 OP_PICK OP_TOALTSTACK OP_5 OP_ROLL OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_5 OP_ROLL OP_SIZE OP_8 OP_EQUALVERIFY OP_CAT OP_SWAP OP_CAT OP_HASH256 OP_SWAP OP_TOALTSTACK OP_CAT OP_CAT OP_SWAP OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_FROMALTSTACK OP_CAT OP_SWAP OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_HASH256 00 OP_CAT OP_BIN2NUM OP_FROMALTSTACK OP_SIZE OP_4 OP_EQUALVERIFY OP_3 OP_SPLIT OP_DUP OP_BIN2NUM OP_3 21 OP_WITHIN OP_VERIFY OP_TOALTSTACK OP_DUP OP_BIN2NUM 0 OP_GREATERTHAN OP_VERIFY 0000000000000000000000000000000000000000000000000000000000 OP_CAT OP_FROMALTSTACK OP_3 OP_SUB OP_8 OP_MUL OP_RSHIFT 00 OP_CAT OP_BIN2NUM OP_LESSTHAN OP_VERIFY OP_DUP OP_HASH160 OP_FROMALTSTACK OP_EQUALVERIFY OP_CHECKSIG")


  })
  it("creates redemptions", async ()=>{
    const transaction = index.transaction.fromTransaction(new bsv.Transaction("01000000011bf9e9b36b9c41ae70e58fbf05c0200d90877ac873b23900269d0233fd4f74230000000098483045022100daeac81ac998e1d278b1d1135c44f13d09bfd9e91aa6753b5434f46ad386256702206995d92e6698a3e86ca47077bae2094b25dfa3012f7fae88469c918d6fdbda4d412102f7cb3418d5e188a3984d4ab184a45b8d6df090e00527fafa310b166cc98dbe9504679f73000441c6986408718356900544724d040b4609d214e2db8bda89e1c7f85df8c75227818c654c035f1fffffffff01cd0b0000000000001976a914ec50088a9271abe3eab7cc66ae390028ab083a5088ac00000000"));
    expect(transaction.redemptions[0].txid).to.eql("5fe4c50c2b068d0aa7c53e78917e1876b49469ee449728c5c137063e6bdc0f93");
    expect(transaction.redemptions[0].spentTxid).to.eql("23744ffd33029d260039b273c87a87900d20c005bf8fe570ae419c6bb3e9f91b");
  });
})
